services:
  docker:
    image: docker.io/docker:dind
    hostname: docker
    privileged: true
    restart: unless-stopped
    command: ['dockerd', '-H', 'tcp://0.0.0.0:2375', '--tls=false']
    healthcheck:
      test: ["CMD", "docker", "-H", "tcp://docker:2375", "info"]
      interval: 3s
      timeout: 2s
      retries: 10
  forgejo:
    image: docker.io/ravermeister/ci-runner
    hostname: forgejo
    restart: unless-stopped
    depends_on:
      docker:
        condition: service_healthy
    volumes:
      - /etc/forgejo/runner.cfg:/root/.runner
      - /etc/forgejo/config.yml:/etc/forgejo.yml
      - /data/forgejo-runner/cache:/root/.cache/actcache
      - /data/forgejo-runner/host/parent:/root/.cache/act
      - /data/forgejo-runner/docker/parent:/workspace